{"ast":null,"code":"import _asyncToGenerator from \"/Users/kylenewins/Documents/The Moat/the_moat_io/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport AccessTokenHelpers from \"./AccessTokenHelpers.js\";\nimport { emptyAccessToken } from \"./IAuthStrategy.js\";\nexport default class ImplicitGrantStrategy {\n  clientId;\n  redirectUri;\n  scopes;\n  static cacheKey = \"spotify-sdk:ImplicitGrantStrategy:token\";\n  configuration = null;\n\n  get cache() {\n    return this.configuration.cachingStrategy;\n  }\n\n  constructor(clientId, redirectUri, scopes) {\n    this.clientId = clientId;\n    this.redirectUri = redirectUri;\n    this.scopes = scopes;\n  }\n\n  setConfiguration(configuration) {\n    this.configuration = configuration;\n  }\n\n  getOrCreateAccessToken() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const token = yield _this.cache.getOrCreate(ImplicitGrantStrategy.cacheKey, /*#__PURE__*/_asyncToGenerator(function* () {\n        const token = yield _this.redirectOrVerifyToken();\n        return AccessTokenHelpers.toCachable(token);\n      }), /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator(function* (expiring) {\n          return AccessTokenHelpers.refreshCachedAccessToken(_this.clientId, expiring);\n        });\n\n        return function (_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }());\n      return token;\n    })();\n  }\n\n  getAccessToken() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      const token = yield _this2.cache.get(ImplicitGrantStrategy.cacheKey);\n      return token;\n    })();\n  }\n\n  removeAccessToken() {\n    this.cache.remove(ImplicitGrantStrategy.cacheKey);\n  }\n\n  redirectOrVerifyToken() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      const hashParams = new URLSearchParams(window.location.hash.substring(1));\n      const accessToken = hashParams.get(\"access_token\");\n\n      if (accessToken) {\n        return Promise.resolve({\n          access_token: accessToken,\n          token_type: hashParams.get(\"token_type\") ?? \"\",\n          expires_in: parseInt(hashParams.get(\"expires_in\") ?? \"0\"),\n          refresh_token: hashParams.get(\"refresh_token\") ?? \"\",\n          expires: Number(hashParams.get(\"expires\")) || 0\n        });\n      }\n\n      const scopes = _this3.scopes ?? [];\n      var scope = scopes.join(' ');\n      const params = new URLSearchParams();\n      params.append(\"client_id\", _this3.clientId);\n      params.append(\"response_type\", \"token\");\n      params.append(\"redirect_uri\", _this3.redirectUri);\n      params.append(\"scope\", scope);\n      const authUrl = 'https://accounts.spotify.com/authorize?' + params.toString();\n\n      _this3.configuration.redirectionStrategy.redirect(authUrl);\n\n      return emptyAccessToken;\n    })();\n  }\n\n} //# sourceMappingURL=ImplicitGrantStrategy.js.map","map":null,"metadata":{},"sourceType":"module"}